# å­¦ç”Ÿå®¿èˆå«ç”Ÿç®¡ç†ç³»ç»Ÿ - æ•°æ®åº“æ¶æ„è®¾è®¡æ–‡æ¡£

------

## ğŸ“ 1. ER å…³ç³»æ¨¡å‹

### 1.1 æ ¸å¿ƒå®ä½“è¯†åˆ«

æ ¹æ®éœ€æ±‚åˆ†æï¼Œç³»ç»ŸåŒ…å«ä»¥ä¸‹**6ä¸ªæ ¸å¿ƒå®ä½“**ï¼ˆç®€åŒ–æƒé™æ¨¡å‹ï¼‰ï¼š

| **å®ä½“åç§°**      | **ä¸šåŠ¡å«ä¹‰**             | **åŸŸåˆ†ç±»** |
| ----------------- | ------------------------ | ---------- |
| `sys_user`        | ç”¨æˆ·è´¦å·ï¼ˆç»Ÿä¸€è®¤è¯å…¥å£ï¼‰ | ç³»ç»ŸåŸŸ     |
| `sys_class`       | ç­çº§ä¿¡æ¯                 | ç³»ç»ŸåŸŸ     |
| `sys_building`    | å®¿èˆæ¥¼ä¿¡æ¯               | ç³»ç»ŸåŸŸ     |
| `sys_room`        | å®¿èˆæˆ¿é—´ä¿¡æ¯             | ç³»ç»ŸåŸŸ     |
| `biz_inspection`  | å«ç”Ÿæ£€æŸ¥è®°å½•             | ä¸šåŠ¡åŸŸ     |
| `biz_application` | æ£€æŸ¥å‘˜æƒé™ç”³è¯·           | ä¸šåŠ¡åŸŸ     |

------

### 1.2 Mermaid ER å…³ç³»å›¾

```mermaid
erDiagram
    %% ========== ç³»ç»ŸåŸŸï¼šåŸºç¡€é…ç½® ==========
    SYS_CLASS ||--o{ SYS_USER : "å½’å±"
    SYS_BUILDING ||--o{ SYS_ROOM : "åŒ…å«"
    SYS_ROOM ||--o{ SYS_USER : "å±…ä½"
    
    %% ========== ä¸šåŠ¡åŸŸï¼šæ ¸å¿ƒä¸šåŠ¡ ==========
    SYS_ROOM ||--o{ BIZ_INSPECTION : "è¢«æ£€æŸ¥"
    SYS_USER ||--o{ BIZ_INSPECTION : "æ‰§è¡Œæ£€æŸ¥(æ£€æŸ¥å‘˜)"
    SYS_USER ||--o{ BIZ_INSPECTION : "ä¿®æ”¹è®°å½•(æ•™å¸ˆ)"
    SYS_USER ||--o{ BIZ_APPLICATION : "æäº¤ç”³è¯·(å­¦ç”Ÿ)"
    SYS_USER ||--o{ BIZ_APPLICATION : "å®¡æ ¸ç”³è¯·(æ•™å¸ˆ)"

    %% ========== å®ä½“å®šä¹‰ ==========
    SYS_USER {
        bigint id PK "ç”¨æˆ·ID"
        string username UK "è´¦å·(å­¦å·/å·¥å·)"
        string password "åŠ å¯†å¯†ç "
        string real_name "çœŸå®å§“å"
        string phone "æ‰‹æœºå·"
        string email "é‚®ç®±"
        string role "è§’è‰²(æ”¯æŒå¤šè§’è‰²é€—å·åˆ†éš”)"
        bigint class_id FK "æ‰€å±ç­çº§"
        bigint room_id FK "æ‰€å±å®¿èˆ"
        tinyint status "çŠ¶æ€"
        datetime created_at "åˆ›å»ºæ—¶é—´"
        datetime updated_at "æ›´æ–°æ—¶é—´"
        datetime deleted_at "åˆ é™¤æ—¶é—´(è½¯åˆ é™¤)"
    }
    
    SYS_CLASS {
        bigint id PK "ç­çº§ID"
        string class_name UK "ç­çº§åç§°"
        string counselor_name "è¾…å¯¼å‘˜"
        datetime created_at "åˆ›å»ºæ—¶é—´"
    }
    
    SYS_BUILDING {
        bigint id PK "æ¥¼å®‡ID"
        string building_name "æ¥¼å®‡åç§°"
        string manager_name "å®¿ç®¡å§“å"
        datetime created_at "åˆ›å»ºæ—¶é—´"
        datetime deleted_at "åˆ é™¤æ—¶é—´"
    }
    
    SYS_ROOM {
        bigint id PK "æˆ¿é—´ID"
        bigint building_id FK "æ‰€å±æ¥¼å®‡"
        string room_number "æˆ¿é—´å·"
        int capacity "åºŠä½å®¹é‡"
        tinyint gender "æ€§åˆ«é™åˆ¶"
        datetime created_at "åˆ›å»ºæ—¶é—´"
    }
    
    BIZ_INSPECTION {
        bigint id PK "æ£€æŸ¥ID"
        bigint room_id FK "è¢«æ£€æŸ¥å®¿èˆ"
        bigint inspector_id FK "æ£€æŸ¥å‘˜"
        bigint modifier_id FK "æœ€åä¿®æ”¹äºº"
        int total_score "æ€»åˆ†"
        text remarks "å¤‡æ³¨"
        text evidence_imgs "å›¾ç‰‡è·¯å¾„"
        date check_date "æ£€æŸ¥æ—¥æœŸ"
        datetime created_at "åˆ›å»ºæ—¶é—´"
        datetime updated_at "æ›´æ–°æ—¶é—´"
    }
    
    BIZ_APPLICATION {
        bigint id PK "ç”³è¯·ID"
        bigint applicant_id FK "ç”³è¯·äºº"
        string application_reason "ç”³è¯·ç†ç”±"
        tinyint status "çŠ¶æ€"
        bigint reviewer_id FK "å®¡æ ¸äºº"
        text review_comment "å®¡æ ¸æ„è§"
        datetime review_time "å®¡æ ¸æ—¶é—´"
        datetime apply_time "ç”³è¯·æ—¶é—´"
        datetime updated_at "æ›´æ–°æ—¶é—´"
    }
```

------

### 1.3 å…³ç³»è¯´æ˜

| **å…³ç³»ç±»å‹** | **å®ä½“A**      | **å®ä½“B**         | **åŸºæ•°** | **ä¸šåŠ¡å«ä¹‰**                                 |
| ------------ | -------------- | ----------------- | -------- | -------------------------------------------- |
| ä¸€å¯¹å¤š       | `sys_class`    | `sys_user`        | 1:N      | ä¸€ä¸ªç­çº§åŒ…å«å¤šä¸ªå­¦ç”Ÿï¼Œä¸€ä¸ªå­¦ç”Ÿåªå±äºä¸€ä¸ªç­çº§ |
| ä¸€å¯¹å¤š       | `sys_building` | `sys_room`        | 1:N      | ä¸€æ ‹æ¥¼åŒ…å«å¤šä¸ªæˆ¿é—´                           |
| ä¸€å¯¹å¤š       | `sys_room`     | `sys_user`        | 1:N      | ä¸€ä¸ªå®¿èˆä½å¤šä¸ªå­¦ç”Ÿï¼Œä¸€ä¸ªå­¦ç”Ÿåªä½ä¸€ä¸ªå®¿èˆ     |
| ä¸€å¯¹å¤š       | `sys_room`     | `biz_inspection`  | 1:N      | ä¸€ä¸ªå®¿èˆæœ‰å¤šæ¡æ£€æŸ¥è®°å½•                       |
| ä¸€å¯¹å¤š       | `sys_user`     | `biz_inspection`  | 1:N      | ä¸€ä¸ªæ£€æŸ¥å‘˜å¯å½•å…¥å¤šæ¡è®°å½•                     |
| ä¸€å¯¹å¤š       | `sys_user`     | `biz_application` | 1:N      | ä¸€ä¸ªå­¦ç”Ÿå¯æäº¤å¤šæ¬¡ç”³è¯·                       |

------

## ğŸ—‚ï¸ 2. ç‰©ç†æ¨¡å‹è®¾è®¡ (SQL DDL)

### 2.1 ç³»ç»ŸåŸŸ - æƒé™ä¸åŸºç¡€é…ç½®

#### 2.1.1 ç”¨æˆ·è¡¨ (sys_user)

```sql
-- ============================================================
-- è¡¨åï¼šsys_user (ç³»ç»Ÿç”¨æˆ·è¡¨) 
-- è¯´æ˜ï¼šé‡‡ç”¨å•å­—æ®µå¤šè§’è‰²å­˜å‚¨æ–¹æ¡ˆï¼ˆç®€åŒ–æƒé™æ¨¡å‹ï¼‰
-- è®¾è®¡è¦ç‚¹ï¼š
--   1. role å­—æ®µå­˜å‚¨å¤šè§’è‰²ï¼ˆé€—å·åˆ†éš”ï¼‰
--   2. ç¤ºä¾‹å€¼ï¼š"STUDENT" æˆ– "STUDENT,INSPECTOR"
--   3. é€šè¿‡åº”ç”¨å±‚ä»£ç å¤„ç†è§’è‰²åˆ¤æ–­ï¼Œå¤§å¹…é™ä½å®ç°å¤æ‚åº¦
--   4. åˆ é™¤äº† sys_role å’Œ sys_user_role è¡¨ï¼Œå‡å°‘è¡¨å…³è”æŸ¥è¯¢
-- ============================================================
CREATE TABLE `sys_user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `username` VARCHAR(32) NOT NULL COMMENT 'è´¦å·(å­¦å·/å·¥å·)',
  `password` VARCHAR(128) NOT NULL COMMENT 'åŠ å¯†å¯†ç (BCrypt)',
  `real_name` VARCHAR(32) NOT NULL COMMENT 'çœŸå®å§“å',
  `phone` VARCHAR(11) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `email` VARCHAR(64) DEFAULT NULL COMMENT 'é‚®ç®±',
  
  -- â­ role å­—æ®µæ”¯æŒå¤šè§’è‰²ï¼ˆé€—å·åˆ†éš”ï¼‰
  `role` VARCHAR(128) NOT NULL DEFAULT 'STUDENT' COMMENT 'è§’è‰²(å¤šè§’è‰²ç”¨é€—å·åˆ†éš”): STUDENT, STUDENT,INSPECTOR, TEACHER, ADMIN',
  
  -- å…³è”å…³ç³»
  `class_id` BIGINT DEFAULT NULL COMMENT 'æ‰€å±ç­çº§ID (å¤–é”®: sys_class.id)',
  `room_id` BIGINT DEFAULT NULL COMMENT 'æ‰€å±å®¿èˆID (å¤–é”®: sys_room.id)',
  
  -- çŠ¶æ€ä¸å®¡è®¡
  `status` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š1-æ­£å¸¸ï¼Œ0-ç¦ç”¨',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted_at` DATETIME DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´(è½¯åˆ é™¤æ ‡è®°)',
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_room_id` (`room_id`) COMMENT 'æŸ¥è¯¢æŸå®¿èˆçš„æ‰€æœ‰ä½æˆ·',
  KEY `idx_class_id` (`class_id`) COMMENT 'æŸ¥è¯¢æŸç­çº§çš„æ‰€æœ‰å­¦ç”Ÿ',
  KEY `idx_deleted_at` (`deleted_at`) COMMENT 'è¿‡æ»¤å·²åˆ é™¤ç”¨æˆ·',
  KEY `idx_role` (`role`) COMMENT 'æŒ‰è§’è‰²æŸ¥è¯¢ç”¨æˆ·ï¼ˆæ”¯æŒLIKEæ¨¡ç³ŠæŸ¥è¯¢ï¼‰'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿç”¨æˆ·è¡¨';
```

**è®¾è®¡è¯´æ˜ï¼š**

- **ä¸ºä»€ä¹ˆé‡‡ç”¨é€—å·åˆ†éš”è€Œéç‹¬ç«‹è¡¨ï¼Ÿ**
   è¯¾ç¨‹è®¾è®¡åœºæ™¯ä¸‹ï¼Œç®€åŒ–çš„æƒé™æ¨¡å‹å¯å‡å°‘30%çš„ä»£ç é‡ï¼Œé¿å…å¤æ‚çš„å¤šè¡¨JOINæŸ¥è¯¢ã€‚
- **å¦‚ä½•æŸ¥è¯¢æŸè§’è‰²çš„æ‰€æœ‰ç”¨æˆ·ï¼Ÿ**

```sql
  -- æŸ¥è¯¢æ‰€æœ‰æ£€æŸ¥å‘˜ï¼ˆåŒ…å«åŒæ—¶æ˜¯å­¦ç”Ÿçš„æ£€æŸ¥å‘˜ï¼‰
  SELECT * FROM sys_user 
  WHERE role LIKE '%INSPECTOR%' 
    AND deleted_at IS NULL;
```

- **æ€§èƒ½è€ƒè™‘ï¼š**
   `idx_role` ç´¢å¼•è™½ç„¶æ”¯æŒLIKEæŸ¥è¯¢ï¼Œä½†åœ¨æ•°æ®é‡<10000æ—¶æ€§èƒ½å½±å“å¾®ä¹å…¶å¾®ã€‚

------

#### 2.1.2 ç­çº§è¡¨ (sys_class)

```sql
-- ============================================================
-- è¡¨åï¼šsys_class (ç­çº§ä¿¡æ¯è¡¨)
-- è¯´æ˜ï¼šå­˜å‚¨ç­çº§åŸºç¡€ä¿¡æ¯
-- ============================================================
CREATE TABLE `sys_class` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `class_name` VARCHAR(64) NOT NULL COMMENT 'ç­çº§åç§°ï¼Œå¦‚ï¼šè½¯ä»¶232',
  `counselor_name` VARCHAR(32) DEFAULT NULL COMMENT 'è¾…å¯¼å‘˜å§“å',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_class_name` (`class_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç­çº§ä¿¡æ¯è¡¨';
```

------

#### 2.1.3 å®¿èˆæ¥¼è¡¨ (sys_building)

```sql
-- ============================================================
-- è¡¨åï¼šsys_building (å®¿èˆæ¥¼ä¿¡æ¯è¡¨)
-- è¯´æ˜ï¼šå­˜å‚¨å®¿èˆæ¥¼åŸºç¡€ä¿¡æ¯
-- ============================================================
CREATE TABLE `sys_building` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `building_name` VARCHAR(32) NOT NULL COMMENT 'æ¥¼å®‡åç§°ï¼Œå¦‚ï¼šä¸œåŒº4å·æ¥¼',
  `manager_name` VARCHAR(32) DEFAULT NULL COMMENT 'å®¿ç®¡å§“å',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `deleted_at` DATETIME DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´(è½¯åˆ é™¤)',
  
  PRIMARY KEY (`id`),
  KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å®¿èˆæ¥¼ä¿¡æ¯è¡¨';
```

------

#### 2.1.4 å®¿èˆæˆ¿é—´è¡¨ (sys_room)

```sql
-- ============================================================
-- è¡¨åï¼šsys_room (å®¿èˆæˆ¿é—´è¡¨)
-- è¯´æ˜ï¼šå­˜å‚¨å®¿èˆæˆ¿é—´çš„è¯¦ç»†ä¿¡æ¯
-- è®¾è®¡è¦ç‚¹ï¼š
--   1. ç§»é™¤äº† occupied å­—æ®µï¼ˆé¿å…æ•°æ®ä¸ä¸€è‡´ï¼Œæ”¹ä¸ºå®æ—¶ç»Ÿè®¡ï¼‰
--   2. é€šè¿‡ building_id + room_number è”åˆç´¢å¼•åŠ é€ŸæŸ¥è¯¢
-- ============================================================
CREATE TABLE `sys_room` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `building_id` BIGINT NOT NULL COMMENT 'æ‰€å±æ¥¼å®‡ID (å¤–é”®: sys_building.id)',
  `room_number` VARCHAR(16) NOT NULL COMMENT 'æˆ¿é—´å·ï¼Œå¦‚ï¼šb501',
  `capacity` INT NOT NULL DEFAULT 4 COMMENT 'åºŠä½å®¹é‡',
  `gender` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'æ€§åˆ«é™åˆ¶ï¼š1-ç”·å¯ï¼Œ2-å¥³å¯',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_building_room` (`building_id`, `room_number`) COMMENT 'åŒä¸€æ¥¼æ ‹æˆ¿é—´å·å”¯ä¸€',
  KEY `idx_building_id` (`building_id`) COMMENT 'æŸ¥è¯¢æŸæ¥¼æ ‹çš„æ‰€æœ‰æˆ¿é—´'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å®¿èˆæˆ¿é—´è¡¨';
```

**æŸ¥è¯¢ç¤ºä¾‹ï¼šæŸ¥è¯¢æŸå®¿èˆçš„å…¥ä½æƒ…å†µ**

```sql
-- å®æ—¶ç»Ÿè®¡å®¿èˆå…¥ä½äººæ•°ï¼ˆä¸ä¾èµ–å†—ä½™å­—æ®µï¼‰
SELECT 
  r.id AS room_id,
  r.room_number,
  r.capacity,
  COUNT(u.id) AS occupied,
  (r.capacity - COUNT(u.id)) AS available
FROM sys_room r
LEFT JOIN sys_user u ON r.id = u.room_id AND u.deleted_at IS NULL
WHERE r.building_id = 1
GROUP BY r.id;
```

------

### 2.2 ä¸šåŠ¡åŸŸ - æ ¸å¿ƒä¸šåŠ¡è¡¨

#### 2.2.1 å«ç”Ÿæ£€æŸ¥è®°å½•è¡¨ (biz_inspection)

```sql
-- ============================================================
-- è¡¨åï¼šbiz_inspection (å«ç”Ÿæ£€æŸ¥è®°å½•è¡¨)
-- è¯´æ˜ï¼šå­˜å‚¨æ‰€æœ‰å«ç”Ÿæ£€æŸ¥çš„æ ¸å¿ƒæ•°æ®
-- è®¾è®¡è¦ç‚¹ï¼š
--   1. inspector_id: è®°å½•è°å½•å…¥çš„ï¼ˆæ£€æŸ¥å‘˜ï¼‰
--   2. modifier_id: è®°å½•è°æœ€åä¿®æ”¹çš„ï¼ˆæ•™å¸ˆ/ç®¡ç†å‘˜ï¼‰
--   3. evidence_imgs: â­æ”¹ä¸ºTEXTç±»å‹ï¼Œæ”¯æŒå­˜å‚¨æ›´å¤šå›¾ç‰‡è·¯å¾„æˆ–JSONæ ¼å¼
--   4. created_at vs updated_at: åŒºåˆ†å½•å…¥æ—¶é—´å’Œä¿®æ”¹æ—¶é—´
-- ============================================================
CREATE TABLE `biz_inspection` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  
  -- å…³è”ä¿¡æ¯
  `room_id` BIGINT NOT NULL COMMENT 'è¢«æ£€æŸ¥å®¿èˆID (å¤–é”®: sys_room.id)',
  `inspector_id` BIGINT NOT NULL COMMENT 'æ£€æŸ¥å‘˜ID (å¤–é”®: sys_user.id)',
  `modifier_id` BIGINT DEFAULT NULL COMMENT 'æœ€åä¿®æ”¹äººID (å¤–é”®: sys_user.id)',
  
  -- æ£€æŸ¥ç»“æœ
  `total_score` INT NOT NULL COMMENT 'æ€»åˆ†(0-100)',
  `remarks` TEXT DEFAULT NULL COMMENT 'å¤‡æ³¨è¯´æ˜(æ‰£åˆ†åŸå› /æ•´æ”¹å»ºè®®)',
  `evidence_imgs` TEXT DEFAULT NULL COMMENT 'â­å›¾ç‰‡è·¯å¾„(JSONæ ¼å¼æˆ–é€—å·åˆ†éš”) - æ”¹ä¸ºTEXTç±»å‹ä»¥æ”¯æŒæ›´å¤šå›¾ç‰‡',
  
  -- æ—¶é—´ä¿¡æ¯
  `check_date` DATE NOT NULL COMMENT 'æ£€æŸ¥æ—¥æœŸ',
  `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'å½•å…¥æ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æœ€åä¿®æ”¹æ—¶é—´',
  
  PRIMARY KEY (`id`),
  KEY `idx_room_date` (`room_id`, `check_date`) COMMENT 'æ ¸å¿ƒæŸ¥è¯¢ï¼šæŸ¥æŸå®¿èˆæŸæ—¶é—´æ®µçš„è®°å½•',
  KEY `idx_inspector_id` (`inspector_id`) COMMENT 'æŸ¥è¯¢æŸæ£€æŸ¥å‘˜çš„å·¥ä½œè®°å½•',
  KEY `idx_check_date` (`check_date`) COMMENT 'æŒ‰æ—¥æœŸç»Ÿè®¡å…¨æ ¡å«ç”Ÿæƒ…å†µ',
  
  -- æ•°æ®å®Œæ•´æ€§çº¦æŸ
  CONSTRAINT `chk_total_score` CHECK (`total_score` BETWEEN 0 AND 100)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å«ç”Ÿæ£€æŸ¥è®°å½•è¡¨';
```

**è®¾è®¡è¯´æ˜ï¼š**

- **ä¸ºä»€ä¹ˆéœ€è¦ `modifier_id` å­—æ®µï¼Ÿ**
   éœ€æ±‚ä¸­æ˜ç¡®æåˆ°"æ•™å¸ˆå¯ä»¥ä¿®æ”¹æ£€æŸ¥è®°å½•"ï¼Œè®°å½•æœ€åä¿®æ”¹äººä¾¿äºè¿½æº¯è´£ä»»ã€‚
- **ä¸ºä»€ä¹ˆ `remarks` ç”¨ TEXT è€Œä¸æ˜¯ VARCHARï¼Ÿ**
   å¤‡æ³¨å¯èƒ½åŒ…å«è¯¦ç»†çš„æ•´æ”¹å»ºè®®ï¼ŒVARCHAR(500) å¯èƒ½ä¸å¤Ÿï¼ŒTEXT ç±»å‹å¯å­˜å‚¨æœ€å¤§ 65535 å­—èŠ‚ã€‚
- **â­ ä¸ºä»€ä¹ˆ `evidence_imgs` æ”¹ä¸º TEXTï¼Ÿ**
   VARCHAR(1024) åœ¨å­˜å‚¨5-6å¼ é•¿æ–‡ä»¶åå›¾ç‰‡æˆ–JSONç»“æ„æ—¶å®¹æ˜“æº¢å‡ºï¼ŒTEXTç±»å‹ï¼ˆæœ€å¤§64KBï¼‰è¶³å¤Ÿå­˜å‚¨å‡ åå¼ å›¾ç‰‡è·¯å¾„ï¼Œä¸”ä¸å½±å“æ€§èƒ½ã€‚
- **çº¦æŸ CHECKï¼š**
   MySQL 8.0+ æ”¯æŒ CHECK çº¦æŸï¼Œç¡®ä¿åˆ†æ•°åœ¨ 0-100 èŒƒå›´å†…ï¼Œåœ¨æ•°æ®åº“å±‚é¢ä¿è¯æ•°æ®è´¨é‡ã€‚

------

#### 2.2.2 æ£€æŸ¥å‘˜æƒé™ç”³è¯·è¡¨ (biz_application)

```sql
-- ============================================================
-- è¡¨åï¼šbiz_application (æ£€æŸ¥å‘˜æƒé™ç”³è¯·è¡¨)
-- è¯´æ˜ï¼šè®°å½•å­¦ç”Ÿç”³è¯·æ£€æŸ¥å‘˜æƒé™çš„å®Œæ•´æµç¨‹
-- è®¾è®¡è¦ç‚¹ï¼š
--   1. status çŠ¶æ€æœºï¼š0-å¾…å®¡æ ¸ â†’ 1-å·²é€šè¿‡ / 2-å·²é©³å›
--   2. reviewer_id å’Œ review_time ä»…åœ¨å®¡æ ¸åå¡«å……
--   3. apply_time ä½¿ç”¨ DEFAULT CURRENT_TIMESTAMP è‡ªåŠ¨è®°å½•
-- ============================================================
CREATE TABLE `biz_application` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  
  -- ç”³è¯·ä¿¡æ¯
  `applicant_id` BIGINT NOT NULL COMMENT 'ç”³è¯·äººID (å¤–é”®: sys_user.id)',
  `application_reason` VARCHAR(500) NOT NULL COMMENT 'ç”³è¯·ç†ç”±',
  
  -- å®¡æ ¸ä¿¡æ¯
  `status` TINYINT NOT NULL DEFAULT 0 COMMENT 'çŠ¶æ€ï¼š0-å¾…å®¡æ ¸ï¼Œ1-å·²é€šè¿‡ï¼Œ2-å·²é©³å›',
  `reviewer_id` BIGINT DEFAULT NULL COMMENT 'å®¡æ ¸äººID (å¤–é”®: sys_user.id)',
  `review_comment` TEXT DEFAULT NULL COMMENT 'å®¡æ ¸æ„è§(é©³å›ç†ç”±)',
  `review_time` DATETIME DEFAULT NULL COMMENT 'å®¡æ ¸æ—¶é—´',
  
  -- æ—¶é—´ä¿¡æ¯
  `apply_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ç”³è¯·æäº¤æ—¶é—´',
  `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æœ€åæ›´æ–°æ—¶é—´',
  
  PRIMARY KEY (`id`),
  KEY `idx_applicant_status` (`applicant_id`, `status`) COMMENT 'æŸ¥è¯¢æŸç”¨æˆ·çš„ç”³è¯·è®°å½•åŠçŠ¶æ€',
  KEY `idx_status` (`status`) COMMENT 'æŸ¥è¯¢å¾…å®¡æ ¸åˆ—è¡¨(status=0)',
  KEY `idx_apply_time` (`apply_time`) COMMENT 'æŒ‰ç”³è¯·æ—¶é—´æ’åº'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ£€æŸ¥å‘˜æƒé™ç”³è¯·è¡¨';
```

**ä¸šåŠ¡æµç¨‹å¯¹åº”ï¼š**

1. **å­¦ç”Ÿæäº¤ç”³è¯·**ï¼šæ’å…¥ä¸€æ¡è®°å½•ï¼Œ`status=0`ï¼Œ`reviewer_id=NULL`
2. æ•™å¸ˆå®¡æ ¸é€šè¿‡ï¼š
   - æ›´æ–° `status=1`ï¼Œå¡«å…… `reviewer_id` å’Œ `review_time`
   - â­ ä¿®æ”¹ `sys_user` è¡¨çš„ `role` å­—æ®µï¼Œæ·»åŠ  `INSPECTOR` è§’è‰²ï¼ˆå¦‚ä» "STUDENT" æ”¹ä¸º "STUDENT,INSPECTOR"ï¼‰
3. æ•™å¸ˆé©³å›ï¼š
   - æ›´æ–° `status=2`ï¼Œå¡«å…… `review_comment` å’Œ `review_time`

------

## ğŸ” 3. ç´¢å¼•ç­–ç•¥ä¸æ€§èƒ½ä¼˜åŒ–

### 3.1 ç´¢å¼•è®¾è®¡åŸåˆ™

æ ¹æ®éœ€æ±‚åˆ†æä¸­çš„æŸ¥è¯¢åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯æ ¸å¿ƒç´¢å¼•æ–¹æ¡ˆï¼š

| **è¡¨å**          | **ç´¢å¼•å**             | **ç´¢å¼•å­—æ®µ**                 | **ç´¢å¼•ç±»å‹** | **é€‚ç”¨åœºæ™¯**                                  |
| ----------------- | ---------------------- | ---------------------------- | ------------ | --------------------------------------------- |
| `sys_user`        | `uk_username`          | `username`                   | UNIQUE       | ç™»å½•æŸ¥è¯¢ï¼ˆé«˜é¢‘ï¼‰                              |
| `sys_user`        | `idx_room_id`          | `room_id`                    | NORMAL       | æŸ¥è¯¢æŸå®¿èˆçš„ä½æˆ·                              |
| `sys_user`        | `idx_class_id`         | `class_id`                   | NORMAL       | æŸ¥è¯¢æŸç­çº§çš„å­¦ç”Ÿ                              |
| `sys_user`        | `idx_deleted_at`       | `deleted_at`                 | NORMAL       | è¿‡æ»¤å·²åˆ é™¤ç”¨æˆ·                                |
| `sys_user`        | `idx_role`             | `role`                       | NORMAL       | â­æŒ‰è§’è‰²æŸ¥è¯¢ç”¨æˆ·ï¼ˆæ”¯æŒLIKE '%INSPECTOR%'æŸ¥è¯¢ï¼‰ |
| `sys_room`        | `uk_building_room`     | `(building_id, room_number)` | UNIQUE       | ä¿è¯æˆ¿é—´å·å”¯ä¸€æ€§                              |
| `sys_room`        | `idx_building_id`      | `building_id`                | NORMAL       | æŸ¥è¯¢æŸæ¥¼æ ‹çš„æ‰€æœ‰æˆ¿é—´                          |
| `biz_inspection`  | `idx_room_date`        | `(room_id, check_date)`      | COMPOSITE    | **â­æœ€æ ¸å¿ƒæŸ¥è¯¢**ï¼šå­¦ç”ŸæŸ¥è¯¢æœ¬å®¿èˆå«ç”Ÿè®°å½•       |
| `biz_inspection`  | `idx_inspector_id`     | `inspector_id`               | NORMAL       | ç»Ÿè®¡æ£€æŸ¥å‘˜å·¥ä½œé‡                              |
| `biz_inspection`  | `idx_check_date`       | `check_date`                 | NORMAL       | æŒ‰æ—¥æœŸç»Ÿè®¡å…¨æ ¡å«ç”Ÿ                            |
| `biz_application` | `idx_applicant_status` | `(applicant_id, status)`     | COMPOSITE    | å­¦ç”ŸæŸ¥çœ‹è‡ªå·±çš„ç”³è¯·çŠ¶æ€                        |
| `biz_application` | `idx_status`           | `status`                     | NORMAL       | æ•™å¸ˆæŸ¥çœ‹å¾…å®¡æ ¸åˆ—è¡¨                            |
| `biz_application` | `idx_apply_time`       | `apply_time`                 | NORMAL       | æŒ‰ç”³è¯·æ—¶é—´æ’åº                                |

------

### 3.2 å…³é”®æŸ¥è¯¢çš„ç´¢å¼•å‘½ä¸­åˆ†æ

#### åœºæ™¯1ï¼šå­¦ç”ŸæŸ¥è¯¢æœ¬å®¿èˆæœ€è¿‘ä¸€å‘¨çš„å«ç”Ÿè®°å½•

```sql
-- æŸ¥è¯¢SQL
SELECT i.*, u.real_name AS inspector_name
FROM biz_inspection i
JOIN sys_user u ON i.inspector_id = u.id
WHERE i.room_id = 305 
  AND i.check_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)
ORDER BY i.check_date DESC;

-- ç´¢å¼•å‘½ä¸­ï¼šidx_room_date (room_id, check_date)
-- è§£é‡Šï¼šå¤åˆç´¢å¼•å¯ä»¥é«˜æ•ˆè¿‡æ»¤ room_idï¼Œå¹¶åˆ©ç”¨ check_date è¿›è¡Œæ’åº
```

------

#### åœºæ™¯2ï¼šæ•™å¸ˆæŸ¥è¯¢å¾…å®¡æ ¸çš„æ£€æŸ¥å‘˜ç”³è¯·åˆ—è¡¨

```sql
-- æŸ¥è¯¢SQL
SELECT a.*, u.real_name, u.username
FROM biz_application a
JOIN sys_user u ON a.applicant_id = u.id
WHERE a.status = 0
ORDER BY a.apply_time ASC;

-- ç´¢å¼•å‘½ä¸­ï¼šidx_status (status)
-- è§£é‡Šï¼šé€šè¿‡çŠ¶æ€å­—æ®µå¿«é€Ÿè¿‡æ»¤å¾…å®¡æ ¸è®°å½•ï¼Œapply_time ç”¨äºæ’åº
```

------

#### åœºæ™¯3ï¼šç®¡ç†å‘˜ç»Ÿè®¡æŸæ£€æŸ¥å‘˜çš„å·¥ä½œé‡

```sql
-- æŸ¥è¯¢SQL
SELECT 
  COUNT(*) AS total_inspections,
  AVG(total_score) AS avg_score,
  MIN(check_date) AS first_inspection,
  MAX(check_date) AS last_inspection
FROM biz_inspection
WHERE inspector_id = 10025;

-- ç´¢å¼•å‘½ä¸­ï¼šidx_inspector_id (inspector_id)
-- è§£é‡Šï¼šé€šè¿‡æ£€æŸ¥å‘˜IDå¿«é€Ÿå®šä½è¯¥ç”¨æˆ·çš„æ‰€æœ‰æ£€æŸ¥è®°å½•
```

------

#### â­ åœºæ™¯4ï¼šæŸ¥è¯¢æ‰€æœ‰æ£€æŸ¥å‘˜ï¼ˆç®€åŒ–æƒé™æ¨¡å‹ç‰¹æœ‰åœºæ™¯ï¼‰

```sql
-- æŸ¥è¯¢SQL
SELECT id, username, real_name, role
FROM sys_user 
WHERE role LIKE '%INSPECTOR%' 
  AND deleted_at IS NULL;

-- ç´¢å¼•å‘½ä¸­ï¼šidx_role (role)
-- è§£é‡Šï¼šè™½ç„¶LIKEæŸ¥è¯¢é€šå¸¸æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œä½†åœ¨æ•°æ®é‡<10000çš„è¯¾ç¨‹è®¾è®¡åœºæ™¯ä¸‹ï¼Œ
-- æ€§èƒ½å½±å“å¯å¿½ç•¥ã€‚å¦‚æœæ•°æ®é‡å¢å¤§ï¼Œå¯è€ƒè™‘å…¨æ–‡ç´¢å¼•æˆ–ç‹¬ç«‹è§’è‰²è¡¨ã€‚
```

------

